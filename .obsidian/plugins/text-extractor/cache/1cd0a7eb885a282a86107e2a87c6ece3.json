{"path":".obsidian/plugins/text-extractor/cache/1cd0a7eb885a282a86107e2a87c6ece3.json","text":"CPSC 317 Computer Networking Transport Layer Lost Segments and Time Out Maryam R.Aliabadi mraiyata@cs.ubc.ca 1CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi READING • Reading: 3.4.1, 3.5.3 2CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Learning goals • Describe/build/execute/trace the various versions of the alternating bit protocol (stop and wait) protocol • Explain how corruption in segments are detected and at what layer(s) in the protocol stack this is done • Explain how data loss is handled by a reliable delivery protocol • For a given scenario determine an appropriate timeout value 3CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Review: Alternating Bit Protocol 4 • Receiver • Sender Idle 0 Wait for ACK 0 Data to send Send data 0 Receive ACK 0 ^ Receive NAK/corrupt Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Receive corrupt data Send NAK Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Receive ACK 1 ^ Receive NAK/corrupt Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive corrupt data Send NAK Receive data 0 Send ACK 0 Receive data 1 Send ACK 1 CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Review: alternating Bit Protocol (no NAK) 5 • Receiver • Sender Idle 0 Wait for ACK 0 Data to send Send data 0 Receive ACK 0 ^ Receive ACK 1/corrupt Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Receive ACK 1 ^ Receive ACK 0/corrupt Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 or corrupt Send ACK 0 Receive data 1 or corrupt Send ACK 1 CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Features To Handle Corruption • Checksums – to detect errors • ACK packets – to detect last correctly received data • Retransmissions – to overcome errors • Sequence numbers – to detect duplicates 6CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Building a Reliable Protocol (v.2) • Let’s create a protocol for reliable delivery • Send only one segment at a time • Identify when sending is allowable action • Identify when re-sending is required • Enumerate events and actions for both sender and receiver • Draw state machine • Next scenario assumptions • One sender, one receiver • Data to send comes from upper layer • Segments can be lost or corrupted 7CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi What if a segment is lost? • What happens if a data segment is lost? • What happens if an ACK is lost? • How to determine if a data segment or ACK is lost? • Who determines it? Sender or receiver? 8CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi What if a segment is lost? • What happens if a data segment is lost? • What happens if an ACK is lost? • How to determine if a data segment or ACK is lost? • Who determines it? Sender or receiver? • What changes are needed on the receiver? • What changes are needed on the sender? 9CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Corrupt or Lost? • Does it make sense to distinguish corrupt data from lost data? • If something is corrupt, we don’t know what’s corrupt • Headers may have been corrupted too • The corrupt segment may not even be for you!!! • So, corrupt data becomes lost data (usually at link layer) 10CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Alternating Bit Protocol (no NAK) 11 • Receiver • Sender Idle 0 Wait for ACK 0 Data to send Send data 0 Receive ACK 0 ^ Receive ACK 1/corrupt Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Receive ACK 1 ^ Receive ACK 0/corrupt Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 or corrupt Send ACK 0 Receive data 1 or corrupt Send ACK 1 CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Eliminate Corrupt Segments 12 • Receiver • Sender Wait for ACK 0 Data to send Send data 0 Receive ACK 0 ^ Receive ACK 1 Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Receive ACK 1 ^ Receive ACK 0 Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 Send ACK 0 Receive data 1 Send ACK 1 Idle 0 / / CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Handle lost segments 13 • Receiver • Sender Wait for ACK 0 Data to send Send data 0 Start timer Receive ACK 0 Cancel timer Receive ACK 1 Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Start timer Receive ACK 1 Cancel timer Receive ACK 0 Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 Send ACK 0 Receive data 1 Send ACK 1 Idle 0 /timeout /timeout CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Clicker question Is this state machine complete? A. Yes B. No 14 Receiver Sender 14 Wait for ACK 0 Data to send Send data 0 Start timer Receive ACK 0 Cancel timer Receive ACK 1/timeout Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Start timer Receive ACK 1 Cancel timer Receive ACK 0/timeout Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 Send ACK 0 Receive data 1 Send ACK 1 Idle 0 CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Answer Is this state machine complete? A. Yes B. No 15 Receiver Sender 15 Wait for ACK 0 Data to send Send data 0 Start timer Receive ACK 0 Cancel timer Receive ACK 1/timeout Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Start timer Receive ACK 1 Cancel timer Receive ACK 0/timeout Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 Send ACK 0 Receive data 1 Send ACK 1 Idle 0 CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Time Out Too Soon 16 Sender Receiver data 0 data 0 ACK 0 ACK 0 CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Alternating Bit Protocol (Timeout) 17 • Receiver • Sender Wait for ACK 0 Data to send Send data 0 Start timer Receive ACK 0 Cancel timer Receive ACK 1/timeout Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Start timer Receive ACK 1 Cancel timer Receive ACK 0/timeout Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 Send ACK 0 Receive data 1 Send ACK 1 Receive anything ^ Receive anything ^ Idle 0 CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi How long should the Timeout be? • Should it be the same across connections? • Should it always be the same for the same connection? • What happens if the timeout is too long? • What happens if the timeout is too short? • What measurable metric can be used to infer a proper timeout? 18CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi How Long Should The Timeout Be? • Assume sequential segments experience the following sequence of RTTs. What should the timeout be? • 10, 10, 10, 10, 10, 10, 10, 10 • 100, 10, 100, 100, 100, 100, 100 • 1000, 10, 10, 10, 10, 10, 10, 10 • 10, 100, 10, 100, 10, 100, 10, 100 • 1, 1, 1, 5, 5, 5, 10, 10, 40, 40, 40, 60, 100, 100, 2, 2, 2, 4, 2 • Discussion in more detail: textbook 3.5.3 19CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Timeout Formula • Assuming measured RTT of 𝑡 • Estimated RTT: 𝐸𝑅𝑇𝑇𝑖 = 1 − 𝛼 × 𝐸𝑅𝑇𝑇𝑖−1 + 𝛼 × 𝑡 • Deviation of RTT (captures jitter): Δ𝑅𝑇𝑇𝑖 = 1 − 𝛽 × Δ𝑅𝑇𝑇𝑖−1 + 𝛽 × 𝑡 − 𝐸𝑅𝑇𝑇𝑖−1 • Timeout: 𝐸𝑅𝑇𝑇𝑖 + 4 × Δ𝑅𝑇𝑇𝑖 • Suggested values: 𝛼 = 0.125, 𝛽 = 0.25 21CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Features To Support Reliable Transport • Checksums – to detect errors • ACK packets – to detect last correctly received data • Retransmissions – to overcome errors, data loss • Sequence numbers – to detect duplicates • Timers – to handle data loss 22CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Performance • Alternating bit protocol aka stop-and-wait protocol • Sender does not send next segment until previous segment acknowledged 23CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Clicker question • Assume a connection from Vancouver to Montreal • Two-way propagation delay is 30 ms • Link speed (bandwidth) is 1Gbps • Segment size is 1000 bytes, including overhead • How much of the link are we actually using? ( Link Utilization = Throughput/Bandwidth) 24CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Answer • Assume a connection from Vancouver to Montreal • Two-way propagation delay is 30 ms • Link speed (bandwidth) is 1Gbps • Segment size is 1000 bytes, including overhead • How much of the link are we actually using? • Transmission delay, one segment: 8000 109 = 0.008 𝑚𝑠 • Throughput: 8000 (30+0.008)/1000 𝑏𝑖𝑡𝑠/𝑠 = 0.267 𝑀𝑏𝑝𝑠 • Utilization: Throughput/Bandwidth = 0.267 𝑀𝑏𝑝𝑠 1 𝐺𝑏𝑝𝑠 = 0.00027 (or 0.027%) 25CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi 0.027% Utilization?? • What can we do about this? 27CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi In-class activity • ICA43 28CPSC 317 – Computer Networking : Transport Layer – Lost Segments Maryam R.Aliabadi Next Topic Windowing Protocols 29","libVersion":"0.2.1","langs":""}