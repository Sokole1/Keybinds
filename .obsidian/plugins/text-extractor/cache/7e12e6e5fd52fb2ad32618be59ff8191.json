{"path":".obsidian/plugins/text-extractor/cache/7e12e6e5fd52fb2ad32618be59ff8191.json","text":"CPSC 317 Computer Networking Transport Layer State Machines Maryam R.Aliabadi mraiyata@cs.ubc.ca 1CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi READING • Reading: 3.4.1 CPSC 317 2023W2 © 2021 2CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Learning goals Protocols and state machines • Given a protocol, express it as a set of communicating finite state machines (FSMs) • Given a set of communicating FSMs, trace the execution of the protocol for various event scenarios • Given a set of communicating FSMs, analyze the execution of the state machines to determine whether or not the protocol operates correctly and propose ways to solve any problems 3CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Reminder: Protocols • From the textbook: A protocol defines the format and the order of messages exchanged between two or more communicating entities, as well as the actions taken on the transmission and/or receipt of a message or other event • Key concepts: • Format and order of messages • Actions to be taken on events • A fully-defined protocol must provide a proper action for any event in any state 4 A few years ago, the Queen visited UBC CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Protocol Example: Greeting the Queen • Don't speak until spoken to • Upon presentation to the Queen • Men do a neck bow • Women a slight curtsy • Queen speaks to you • First salutation is “Your Majesty” • Subsequently it is “Ma'am” 6CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Queen greeting protocol State Machine 7 Wait for Queen Introduced Conversation Go Home Queen presented Bow/curtsy Queen speaks to you Respond, using “Your Majesty” Queen speaks to you Respond, using “Ma’am” Queen leaves Leave Queen leaves Leave Queen skips you Leave CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Building a Reliable Protocol (v.0) • Let’s create a protocol for reliable delivery • Send only one segment at a time • Identify when sending is allowable action • Enumerate events and actions for both sender and receiver • Draw state machine • Initial scenario assumptions • One sender, one receiver • Data to send comes from upper layer • Segments are never lost, never corrupted 8CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi State Machine: Reliable Channel 9 • Receiver • Sender Idle Data to send Send data Wait for data Receive data Deliver data CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi What Could Go Wrong? • We have assumed that nothing bad ever happens • What bad things could happen in a real-world scenario? 10CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Building a Reliable Protocol (V.1) • Let’s create a protocol for reliable delivery • Send only one segment at a time • Identify when sending is allowable action • Identify when re-sending is required • Enumerate events and actions for both sender and receiver • Draw state machine • Next scenario assumptions • One sender, one receiver • Data to send comes from upper layer • Segments are never lost, but may be corrupted 11CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Possible Events and Actions 12 • Receiver • Segment received without problems • Send ACK • Segment received corrupted • Send NAK • Sender • Data ready to send • Send data • Receive ACK • Get ready to send more data • Receive NAK • Re-send data CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi State Machine: Corruption Scenario 13 • Receiver • Sender Idle Wait for ACK Data to send Send data Receive ACK ^ Receive NAK Re-send data Wait for data Receive valid data Deliver data Send ACK Receive corrupt data Send NAK CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi The ACK/NAK might be corrupted • What if the ACK/NAK is corrupted? • Sender cannot be sure if the receiver received the previous segment • What can the sender do after receiving a corrupted ACK/NAK? • Ignore the corrupt ACK/NAK? • Everything will stop • Treat it as an ACK? • Treat it as a NAK? 14CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi State Machine: Corruption Option I 15 • Receiver • Sender Idle Wait for ACK Data to send Send data Receive ACK ^ Receive NAK Re-send data Wait for data Receive valid data Deliver data Send ACK Receive corrupt data Send NAK Receive corrupt ^ CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi The ACK/NAK might be Corrupted • What if the ACK/NAK is corrupted? • Sender cannot be sure if the receiver received the previous segment • What can the sender do after receiving a corrupted ACK/NAK? • Ignore the corrupt ACK/NAK? • Everything stops • Treat it as an ACK? • If it was a NAK, the receiver never receives the data • Treat it as a NAK? 16CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi State Machine: Corruption Option II 17 • Receiver • Sender Idle Wait for ACK Data to send Send data Receive ACK or corrupt ^ Receive NAK Re-send data Wait for data Receive valid data Deliver data Send ACK Receive corrupt data Send NAK CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi The ACK/NAK might be Corrupted • What if the ACK/NAK is corrupted? • Sender cannot be sure if the receiver received the previous segment • What can the sender do after receiving a corrupted ACK/NAK? • Ignore the corrupt ACK/NAK? • Everything stops • Treat it as an ACK? • If it was a NAK, the receiver never receives the data • Treat it as a NAK? • If it was an ACK, the receiver receives the data twice 18CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi State Machine: Corruption option III 19 • Receiver • Sender Idle Wait for ACK Data to send Send data Receive ACK ^ Receive NAK or corrupt Re-send data Wait for data Receive valid data Deliver data Send ACK Receive corrupt data Send NAK CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Dealing With Duplicate Transfer • How can the receiver deal with a duplicate segment? • What information needs to be included to allow receiver to identify segment as duplicate? • Reminder: scenario does not lose data, only corrupts 20 → One Bit Alternating CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Possible Events 21 • Receiver • Segment 0 received without problems • Segment 1 received without problems • Segment received corrupted • Sender • Data ready to send • Receive ACK 0 • Receive ACK 1 • Receive NAK • Receive corrupt response CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Alternating Bit Protocol 22 • Receiver • Sender Idle 0 Wait for ACK 0 Data to send Send data Receive ACK ^ Receive NAK/corrupt Re-send data Wait for data Receive data Deliver data Send ACK Receive corrupt data Send NAK CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Alternating Bit Protocol 23 • Receiver • Sender Idle 0 Wait for ACK 0 Data to send Send data 0 Receive ACK 0 ^ Receive NAK/corrupt Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Receive corrupt data Send NAK Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Receive ACK 1 ^ Receive NAK/corrupt Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive corrupt data Send NAK Receive data 1 Send ACK 1 CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Alternating Bit Protocol (No NAK) 24 • Receiver • Sender Idle 0 Wait for ACK 0 Data to send Send data 0 Receive ACK 0 ^ Receive ACK 1/corrupt Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Receive ACK 1 ^ Receive data 1 Deliver data Send ACK 1 Receive data 0 or corrupt Send ACK 0 Receive data 1 or corrupt Send ACK 1 CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Clicker question Is this state machine complete? A. Yes B. No CPSC 317 2023W2 © 2021 25 Receiver Sender 25 Idle 0 Wait for ACK 0 Data to send Send data 0 Receive ACK 0 ^ Receive ACK 1/corrupt Re-send data 0 Wait for data 0 Receive data 0 Deliver data Send ACK 0 Idle 1 Wait for ACK 1 Wait for data 1 Data to send Send data 1 Receive ACK 1 ^ Receive ACK 0/corrupt Re-send data 1 Receive data 1 Deliver data Send ACK 1 Receive data 0 or corrupt Send ACK 0 Receive data 1 or corrupt Send ACK 1 CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi In-class activity • ICA42 • Create FSMs for DNS servers CPSC 317 2023W2 © 2021 27CPSC 317 – Computer Networking : Transport Layer – State Machine Maryam R.Aliabadi Next Topic Lost Segments and Time Out 28","libVersion":"0.2.1","langs":""}