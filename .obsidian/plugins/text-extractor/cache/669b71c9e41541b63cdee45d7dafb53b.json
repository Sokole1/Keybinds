{"path":".obsidian/plugins/text-extractor/cache/669b71c9e41541b63cdee45d7dafb53b.json","text":"CP S C 317 Co m put er N e t w o r ki ng Ne t w o r k A d d r e s s T r a n s l a t i o n (N A T) Ma r y a m R . A l i a ba di mr a i y a t a @ c s . u b c . c a 1 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Re a d i n g • Re a d i n g : 4 . 3 . 4 2 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i O u r W o rs t N e t w o r k N a s t y T r i c k • We s h o u l d h a v e r u n o u t o f I P a d d r e s s e s • La s t a d d r es s es a l l o c a t ed b y I A N A o n 3 1 J a n u a r y 2 0 1 1 • R e g i o n a l I n t e rn e t R e g i s t ri e s a l l o c a t e d t h e i r l a s t a d d r e s s e s o n : 3 RI R Date APN IC 15 A p r i l 2011 LA C N I C 10 J une 2014 AR IN 24 S e p t e m b e r 2015 AF R IN IC 21 A p r i l 2017 RI P E N C C 2 5 N o ve m b e r 2 0 1 9 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Tw o c h o i c e s • Act ua l l y sw i t c h t o I P v 6 • Pl a y g a m e s w i t h I Pv 4 a d d r e s s e s p r e t e n d i n g t h a t w e h a v e m o r e t h a n we ac t u ally h a v e 4 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Wh i ch o n e d i d w e ch o o s e ? • Act ua l l y sw i t c h t o I P v 6 • Pl a y g a m e s w i t h I Pv 4 a d d r e s s e s p r e t e n d i n g t h a t w e h a v e m o r e t h a n we ac t u ally h a v e 5 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Her e’ s t he ar g umen t • We h a v e r u n o u t o f I P v 4 a d d r e s s e s • Do y o u ac t u ally n e e d a g lo b ally u n iq u e ad d r e s s ? • Wh a t w o u ld o t h e r h o s t s n e e d y o u r ad d r e s s f o r ? • D o o t h e r h o s t s i n i t i a t e a c o n n e c t i o n t o y o u r h o s t ? • Ra r e l y • Mos t c on n e ct i on s t a r g e t se r v e r s “ ou t t h e r e ” in t h e I n t e rn e t • Ma y be se v e r a l ho s t s c o ul d sha r e a n I P a ddr e ss! 6 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Re m e m b e r t h o s e N o n - Ro u t a b l e I P Addr e sse s? • So m e a d d r e s s e s c a n n e v e r b e a d v e r t i s e d p u b l i c a l l y • I n i t i a l l y u s e d o n l y f o r l o c a l c o m m u n i c a t i o n ( n o I n t e rn e t c o n n e c t i o n ) • Ne t w o r k s : • 10.0.0.0/ 8 ( 16 mi l l i o n a d d r e s s e s ) • 172.16.0.0/ 12 ( 1 mi l l i o n a d d r e s s e s ) • 1 9 2 . 1 6 8 . 0 . 0 / 1 6 ( 6 5 ,5 3 6 a d d r e s s e s ) • C a rri e r - gr a d e N A T : 100.64.0.0/ 10 ( 4 mi l l i o n a d d r e s s e s ) 7 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Her e’ s t he idea • Al l t he ho s t s i n a ne t w o r k ( y o ur ho us e ) s ha r e a s i ng l e I P a ddr e s s • T h e a d d r e s s i s “ o w n e d ” b y t h e e d g e r o u t e r ( c a b l e m o d e m , e t c . ) • T he o ne t ha t a t t a c he s t o y o ur I S P • A l l o t h e r h o s t s i n t h e n e t w o rk ( y o u r h o u s e ) g e t a p ri v a t e n e t w o rk a d d r e s s • We p l a y g a m e s w i t h I P a d d r e s s e s a s d a t a g r a m s p a s s t h r o u g h y o u r ed g e r o u t er 8 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i N e t w o r k A d d r e s s T ra n s l a t i o n ( N a t ) F r o m n o w o n , w e ’l l c a l l t h a t e d g e r o u t e r i n y o u r h o u s e a N A T r o u t e r 9 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Le a r n i n g Goa l s Ne t w o r k A d d r e s s T r a n s l a t i o n ( NA T ) • G i v e n a n I P h e a d e r , e x p l a i n i t s r o l e i n N A T • G i v e n t r a n s p o rt a n d n e t w o rk h e a d e r s f o r a n I P n e t w o rk , t r a c e h o w t h e y a r e u s e d an d c h an g e d w h e n in an NA T e n v ir o n m e n t • T r a c e w h a t h a p p e n s w h e n a r e m o t e m a c h i n e w a n t s t o c o n n e c t t o a s e r v e r b e h i n d a NA T in g ro u t e r • Id e n ti f y t h e s h o rt c o m i n g s o f N A T f o r c e rt a i n c l a s s e s o f a p p l i c a t i o n p r o t o c o l s • E x p l a i n w h y t h e a p p l i c a t i o n l a y e r o f a p p l i c a t i o n s b e h i n d a h o m e r o u t e r g e t s i n v o l v e d i n N A T ( i . e . , f t p : p a s s i v e v e r s u s a c t i v e m o d e ) 10 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i N A T R o u t e r C o n f i g u ra t i o n 11 Th e Int e r ne t CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i N A T R o u t e r C o n f i g u ra t i o n 12 Th e Int e r ne t Fr om : 1 9 2 . 1 6 8 . 0 . 2 : 9 9 9 9 To : 1 2 3 . 4 . 5 . 6 : 8 0 GE T / ab o u t H T T P/ 1 . 1 … Fr om : 1 2 3 . 4 . 5 . 6 : 8 0 To : 2 0 0 . 1 . 2 . 3 : 1 2 3 4 5 HT T P /1 .1 2 0 0 O K … Fr om : 1 2 3 . 4 . 5 . 6 : 8 0 To : 1 9 2 . 1 6 8 . 0 . 2 : 9 9 9 9 HT T P /1 .1 2 0 0 O K … Fr om : 2 0 0 . 1 . 2 . 3 : 1 2 3 4 5 To : 1 2 3 . 4 . 5 . 6 : 8 0 GE T / ab o u t H T T P/ 1 . 1 … CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Iden t if y ing a c o nnec t io n • < s o u r c e I P , s o u r c e p o r t , d e s t i n a t i o n I P , d e s t i n a t i o n p o r t , p r o t o c o l > • P r o t o c o l : t r a n s p o r t , t y p i c a l l y T C P o r U D P • L o c a l ( i n t e r n a l ) a n d r e m o t e • F o r i n c o m i n g m e s s a g e s a t a r o u t e r , l o c a l i s r e c e i v e r , r e m o t e i s s e n d e r • F o r o u t g o i n g m e s s a g e s f r o m a r o u t e r , l o c a l i s s e n d e r , r e m o t e i s r e c e i v e r • e . g . , l o c a l a n d r e m o t e I P , l o c a l a n d r e m o t e p o r t 13 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i H a n d l i n g o f M e s s a g e s t h ro u g h N A T • Wh e n an in t e r n al c lie n t s e n d s a m e s s ag e t o an e x t e r n al s e r v e r • R o u t e r c o n v e rt s s o u r c e I P t o r o u t e r ’ s p u b l i c I P • R o u t e r c o n v e rt s s o u r c e p o rt t o s o m e a v a i l a b l e p o rt • R o u t e r a d d s e n t r y t o N A T t a b l e d e s c ri b i n g t h i s m a p p i n g • s o ur c e I P , s o ur c e po r t , de s t i na t i o n I P , de s t i na t i o n po r t , pr o t o c o l , N A T I P , N A T po r t • Wh e n t h e r e s p o n s e c o m e s fr o m an e x t e r n al s e r v e r • R o u t e r f i n d s N A T t a b l e e n t r y f o r ( s o u r c e I P , s o u r c e p o rt , d e s t i n a t i o n p o rt , p r o t o c o l ) • R o u t e r c h a n g e s d e s t i n a t i o n I P / p o rt t o v a l u e i n t h e t a b l e e n t r y 14 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Cl i c k e r Q u e s ti o n Do e s NA T w o r k a t t h e n e t w o r k l a y e r o r a t t h e t r a n s p o r t l a y e r ? A. Ne t w o r k l a y e r o n l y B. Tr a n s p o r t l a y e r o n l y C. Bo t h n e t w o r k a n d t r a n s p o r t l a y e r D. Ne i t h e r n e t w o r k n o r t r a n s p o r t l a y e r 15 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i NA T F or w a r d i n g T a b l e E x a m p l e In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.1 6445 12.34.5.6 53 TC P 200.1.2.3 12346 192.168.0.1 6553 1.23.45.6 2628 UD P 200.1.2.3 12347 … … … … … … 17 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Mu l t i p l e i n t e rn a l d e v i c e s c o n n e c t i n g t o t h e same se r v e r In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.3 9999 123.4.5.6 80 TC P 200.1.2.3 12348 192.168.0.3 9998 123.4.5.6 80 TC P 200.1.2.3 12349 192.168.0.1 6445 12.34.5.6 53 TC P 200.1.2.3 12346 192.168.0.1 6553 1.23.45.6 2628 UD P 200.1.2.3 12347 … … … … … … 18 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Mu l t i p l e i n t e rn a l d e v i c e s c o n n e c t i n g t o t h e same se r v e r In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.3 9999 123.4.5.6 80 TC P 200.1.2.3 12348 192.168.0.3 9998 123.4.5.6 80 TC P 200.1.2.3 12349 192.168.0.1 6445 12.34.5.6 53 TC P 200.1.2.3 12346 192.168.0.1 6553 1.23.45.6 2628 UD P 200.1.2.3 12347 … … … … … … 19 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Se r v e r on t h e I n s i d e • Wh a t if t h e in it ial c o n n e c t io n c o m e s fr o m o u t s id e ? • E x a m p l e : s e r v e r i s i n s i d e t h e N A T • Ex a m p l e: c o n n ec t i o n w h er e b o t h h o s t s a r e i n s i d e N A T s • NA T t r a n s l a t i o n w i l l n o t f i n d a n e n t r y i n t h e t a b l e 20 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Se r v e r on t h e I n s i d e • O p t i o n 1 : M a n u a l l y a d d a f i x e d ru l e • E x a m pl e : a dd a r ul e t ha t i f a c o nne c t i o n c o m e s t o po r t 2 0 0 . 1 . 2 . 3 : 8 0 8 0 , i t s ho ul d be f o r w a r de d t o 1 9 2 . 1 6 8 . 0 . 2 : 8 0 • Op t i o n 2 : U P n P (U n i v e r sa l P l u g a n d P l a y ) • P r o t o c o l t ha t r uns o n t he r o ut e r a nd i n t e r na l ho s t • H o s t a s k s r o ut e r t o e n t e r a f o r w a r di ng r ul e ( l i k e t he m a nua l r ul e ) 21 In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.2 80 A n y ( m a n u a l / U P n P e n t r y) TC P 200.1.2.3 8080 … … … … … … CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Se r v e r on t h e I n s i d e • A c l i e n t a t 1 2 3 . 4 . 5 . 6 : 1 2 3 4 5 c o n n e c t s t o 2 0 0 . 1 . 2 . 3 : 8 0 8 0 , w h i c h i s fo r w a r d e d t o 1 9 2 . 1 6 8 . 0 . 2 : 8 0 22 In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.2 80 A n y ( m a n u a l / U P n P e n t r y) TC P 200.1.2.3 8080 … … … … … … CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Se r v e r on t h e I n s i d e • A c l i e n t a t 1 2 3 . 4 . 5 . 6 : 1 2 3 4 5 c o n n e c t s t o 2 0 0 . 1 . 2 . 3 : 8 0 8 0 , w h i c h i s fo r w a r d e d t o 1 9 2 . 1 6 8 . 0 . 2 : 8 0 23 In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.2 80 123.4.5.6 12345 TC P 200.1.2.3 8080 192.168.0.2 80 A n y ( m a n u a l / U P n P e n t r y) TC P 200.1.2.3 8080 … … … … … … CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Se r v e r on t h e I n s i d e • A c l i e n t a t 1 2 3 . 4 . 5 . 6 : 1 2 3 4 5 c o n n e c t s t o 2 0 0 . 1 . 2 . 3 : 8 0 8 0 , w h i c h i s fo r w a r d e d t o 1 9 2 . 1 6 8 . 0 . 2 : 8 0 • A n o t h e r c l i e n t a t 1 2 3 . 4 . 5 . 6 : 1 2 3 4 6 c o n n e c t s t o 2 0 0 . 1 . 2 . 3 : 8 0 8 0 , w h i c h is f o r w ar d e d t o 1 9 2 . 1 6 8 . 0 . 2 : 8 0 24 In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.2 80 123.4.5.6 12345 TC P 200.1.2.3 8080 192.168.0.2 80 A n y ( m a n u a l / U P n P e n t r y) TC P 200.1.2.3 8080 … … … … … … CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Se r v e r on t h e I n s i d e • A c l i e n t a t 1 2 3 . 4 . 5 . 6 : 1 2 3 4 5 c o n n e c t s t o 2 0 0 . 1 . 2 . 3 : 8 0 8 0 , w h i c h i s fo r w a r d e d t o 1 9 2 . 1 6 8 . 0 . 2 : 8 0 • A n o t h e r c l i e n t a t 1 2 3 . 4 . 5 . 6 : 1 2 3 4 6 c o n n e c t s t o 2 0 0 . 1 . 2 . 3 : 8 0 8 0 , w h i c h is f o r w ar d e d t o 1 9 2 . 1 6 8 . 0 . 2 : 8 0 25 In t e r n a l IP In t e r n a l Port Re m ot e I P Re m ot e Port Pr ot oc ol NA T IP NA T P o r t 192.168.0.2 9999 123.4.5.6 80 TC P 200.1.2.3 12345 192.168.0.2 80 123.4.5.6 12345 TC P 200.1.2.3 8080 192.168.0.2 80 123.4.5.6 12346 TC P 200.1.2.3 8080 192.168.0.2 80 A n y ( m a n u a l / U P n P e n t r y) TC P 200.1.2.3 8080 … … … … … … CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i P ro b l e m s W i t h N a t ? • De s i g n - le v e l c o n c e r n s • B r e a k s l a y e ri n g • R o u t e r s a r e n ’t s u p p o s e d t o b e m o d i f y i n g I P a d d r e s s e s , m u c h l e s s p o rt s ! • Se cu r i t y c o n ce r n s • P o rt f o r w a r d i n g / U P n P o p e n s p o rt s f o r a n y b o d y t o c o n n e c t t o y o u r d e v i c e • E x p o s e t o v i ru s e s a n d o t h e r a t t a c k s • S o m e a p p l i c a t i o n s d o n ’t w o r k w e l l 26 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Ap p l i c a ti on s a n d N A T • In s o m e a p p l i c a t i o n - l e v e l p r o t o c o l s , c l i e n t s a d v e r t i s e t h e i r I P a d d r e s s in t h e ir m e s s ag e s • I n t e rn a l h o s t a d v e rt i s e s a d d r e s s t o b e u s e d f o r c o n n e c t i o n • Ex a m p l e: F T P a c t i v e m o d e • Ex a m p l e: P 2 P a p p l i c a t i o n s • I f b e h i n d N A T , h o w d o e s c l i e n t k n o w w h i c h I P t o u s e ? • So l u t i o n : d e p e n d s o n t h e a p p l i c a t i o n • FT P : u se p a ssi v e m od e • P 2 P : t y p i c a l l y r e q u i r e m a n u a l s e t u p o r U P n P 27 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i In - cl a s s a cti v i ty • ICA 6 1 29 CP S C 3 1 7 – Co m p u t er N e t w o r k i n g : Ne t w o r k A d d r e s s T r an s la t io n Ma r y a m R . A l i a b a d i Ne x t T o p i c : Lin k La y e r 30","libVersion":"0.2.1","langs":""}